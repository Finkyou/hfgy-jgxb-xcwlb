<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能监控工具 - 合肥工业学校建工宣传外联部</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.15s ease-out;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
        }
        
        .metric-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .metric-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-excellent { background: #d4edda; color: #155724; }
        .status-good { background: #d1ecf1; color: #0c5460; }
        .status-poor { background: #f8d7da; color: #721c24; }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .performance-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.8s ease-out;
            border-radius: 15px;
        }
        
        .performance-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease-out;
            background: #667eea;
            color: white;
        }
        
        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .results {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .results h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 500;
        }
        
        .result-value {
            color: #666;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .actions { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 性能监控工具</h1>
            <p>实时监控网页性能指标，确保最佳用户体验</p>
        </div>
        
        <div class="actions">
            <button class="btn" onclick="runPerformanceTest()">开始性能测试</button>
            <button class="btn btn-secondary" onclick="clearResults()">清除结果</button>
            <button class="btn btn-secondary" onclick="exportResults()">导出报告</button>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">📊 LCP (最大内容绘制)</div>
                <div class="metric-value" id="lcp-value">--</div>
                <div class="metric-status" id="lcp-status">等待测试</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">⚡ FID (首次输入延迟)</div>
                <div class="metric-value" id="fid-value">--</div>
                <div class="metric-status" id="fid-status">等待测试</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">🎯 CLS (累积布局偏移)</div>
                <div class="metric-value" id="cls-value">--</div>
                <div class="metric-status" id="cls-status">等待测试</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">🚀 页面加载时间</div>
                <div class="metric-value" id="load-time-value">--</div>
                <div class="metric-status" id="load-time-status">等待测试</div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">性能评分</div>
            <div class="performance-bar">
                <div class="performance-fill" id="performance-fill" style="width: 0%"></div>
            </div>
            <div class="performance-label">
                <span>0</span>
                <span id="performance-score">0</span>
                <span>100</span>
            </div>
        </div>
        
        <div class="results">
            <h3>详细测试结果</h3>
            <div id="results-content">
                <p>点击"开始性能测试"按钮开始测试...</p>
            </div>
        </div>
    </div>

    <script>
        let performanceData = {};
        
        // 性能测试函数
        function runPerformanceTest() {
            console.log('开始性能测试...');
            
            // 重置状态
            resetMetrics();
            
            // 监听性能指标
            observePerformanceMetrics();
            
            // 模拟用户交互测试
            setTimeout(() => {
                testUserInteractions();
            }, 1000);
            
            // 计算综合评分
            setTimeout(() => {
                calculateOverallScore();
            }, 2000);
        }
        
        // 重置指标
        function resetMetrics() {
            document.getElementById('lcp-value').textContent = '--';
            document.getElementById('fid-value').textContent = '--';
            document.getElementById('cls-value').textContent = '--';
            document.getElementById('load-time-value').textContent = '--';
            
            document.getElementById('lcp-status').textContent = '测试中...';
            document.getElementById('fid-status').textContent = '测试中...';
            document.getElementById('cls-status').textContent = '测试中...';
            document.getElementById('load-time-status').textContent = '测试中...';
            
            document.getElementById('performance-fill').style.width = '0%';
            document.getElementById('performance-score').textContent = '0';
        }
        
        // 监听性能指标
        function observePerformanceMetrics() {
            // 监听LCP
            if ('PerformanceObserver' in window) {
                const lcpObserver = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    updateMetric('lcp', lastEntry.startTime, 'LCP');
                });
                lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });
            }
            
            // 监听CLS
            let clsValue = 0;
            const clsObserver = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (!entry.hadRecentInput) {
                        clsValue += entry.value;
                    }
                }
                updateMetric('cls', clsValue, 'CLS');
            });
            clsObserver.observe({ entryTypes: ['layout-shift'] });
            
            // 页面加载时间
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    if (perfData) {
                        const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                        updateMetric('loadTime', loadTime, '页面加载时间');
                    }
                }, 0);
            });
        }
        
        // 更新指标
        function updateMetric(type, value, label) {
            let displayValue, status, statusClass;
            
            switch(type) {
                case 'lcp':
                    displayValue = `${(value / 1000).toFixed(2)}s`;
                    if (value < 2500) {
                        status = '优秀';
                        statusClass = 'status-excellent';
                    } else if (value < 4000) {
                        status = '良好';
                        statusClass = 'status-good';
                    } else {
                        status = '需要优化';
                        statusClass = 'status-poor';
                    }
                    break;
                    
                case 'cls':
                    displayValue = value.toFixed(3);
                    if (value < 0.1) {
                        status = '优秀';
                        statusClass = 'status-excellent';
                    } else if (value < 0.25) {
                        status = '良好';
                        statusClass = 'status-good';
                    } else {
                        status = '需要优化';
                        statusClass = 'status-poor';
                    }
                    break;
                    
                case 'loadTime':
                    displayValue = `${(value / 1000).toFixed(2)}s`;
                    if (value < 2000) {
                        status = '优秀';
                        statusClass = 'status-excellent';
                    } else if (value < 4000) {
                        status = '良好';
                        statusClass = 'status-good';
                    } else {
                        status = '需要优化';
                        statusClass = 'status-poor';
                    }
                    break;
            }
            
            // 更新显示
            if (type === 'lcp') {
                document.getElementById('lcp-value').textContent = displayValue;
                document.getElementById('lcp-status').textContent = status;
                document.getElementById('lcp-status').className = `metric-status ${statusClass}`;
            } else if (type === 'cls') {
                document.getElementById('cls-value').textContent = displayValue;
                document.getElementById('cls-status').textContent = status;
                document.getElementById('cls-status').className = `metric-status ${statusClass}`;
            } else if (type === 'loadTime') {
                document.getElementById('load-time-value').textContent = displayValue;
                document.getElementById('load-time-status').textContent = status;
                document.getElementById('load-time-status').className = `metric-status ${statusClass}`;
            }
            
            // 存储数据
            performanceData[type] = { value, status, label };
        }
        
        // 测试用户交互
        function testUserInteractions() {
            // 模拟点击测试
            const startTime = performance.now();
            
            // 模拟滚动测试
            window.scrollTo(0, 100);
            setTimeout(() => {
                window.scrollTo(0, 0);
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                // 更新FID指标
                updateMetric('fid', responseTime, 'FID');
            }, 100);
        }
        
        // 计算综合评分
        function calculateOverallScore() {
            let score = 0;
            let totalWeight = 0;
            
            // LCP权重40%
            if (performanceData.lcp) {
                const lcpScore = performanceData.lcp.value < 2500 ? 100 : 
                               performanceData.lcp.value < 4000 ? 70 : 40;
                score += lcpScore * 0.4;
                totalWeight += 0.4;
            }
            
            // CLS权重25%
            if (performanceData.cls) {
                const clsScore = performanceData.cls.value < 0.1 ? 100 : 
                               performanceData.cls.value < 0.25 ? 70 : 40;
                score += clsScore * 0.25;
                totalWeight += 0.25;
            }
            
            // 加载时间权重25%
            if (performanceData.loadTime) {
                const loadScore = performanceData.loadTime.value < 2000 ? 100 : 
                                performanceData.loadTime.value < 4000 ? 70 : 40;
                score += loadScore * 0.25;
                totalWeight += 0.25;
            }
            
            // FID权重10%
            if (performanceData.fid) {
                const fidScore = performanceData.fid.value < 100 ? 100 : 
                               performanceData.fid.value < 300 ? 70 : 40;
                score += fidScore * 0.1;
                totalWeight += 0.1;
            }
            
            if (totalWeight > 0) {
                const finalScore = Math.round(score / totalWeight);
                document.getElementById('performance-score').textContent = finalScore;
                document.getElementById('performance-fill').style.width = finalScore + '%';
                
                // 更新结果内容
                updateResultsContent();
            }
        }
        
        // 更新结果内容
        function updateResultsContent() {
            const resultsContent = document.getElementById('results-content');
            let html = '<div class="result-item"><span class="result-label">测试时间</span><span class="result-value">' + new Date().toLocaleString() + '</span></div>';
            
            for (const [key, data] of Object.entries(performanceData)) {
                html += `<div class="result-item">
                    <span class="result-label">${data.label}</span>
                    <span class="result-value">${data.value} (${data.status})</span>
                </div>`;
            }
            
            resultsContent.innerHTML = html;
        }
        
        // 清除结果
        function clearResults() {
            resetMetrics();
            performanceData = {};
            document.getElementById('results-content').innerHTML = '<p>点击"开始性能测试"按钮开始测试...</p>';
        }
        
        // 导出结果
        function exportResults() {
            const dataStr = JSON.stringify(performanceData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'performance-report.json';
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // 页面加载完成后自动开始测试
        window.addEventListener('load', () => {
            setTimeout(() => {
                runPerformanceTest();
            }, 1000);
        });
    </script>
</body>
</html>
